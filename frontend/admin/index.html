<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">

    <title>Hệ thống quản lý sửa chữa & bảo hành thiết bị – phần mềm</title>
    <link rel="shortcut icon" href="img/favicon.png">
    
    <!-- global stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/font-icon-style.css">
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">

    <!-- Core stylesheets -->
    <link rel="stylesheet" href="css/ui-elements/card.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body> 

<!--MAIN NAVBAR-->        
    <header class="header">
    <nav class="navbar navbar-expand-lg ">
        <div class="container-fluid ">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
                <div class="navbar-header">
                    <a href="index.html" class="navbar-brand">
                        <div class="brand-text brand-big hidden-lg-down">
                            <img src="img/logo.png" width="140" alt="Logo" class="img-fluid">
                        </div>
                        <div class="brand-text brand-small">
                            <img src="img/logo.png" alt="Logo" class="img-fluid">
                        </div>
                    </a>
                    </div>
            </div>

            <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                <li class="nav-item d-flex align-items-center full_scr_exp">
                    <a class="nav-link" href="#">
                        <img src="img/expand.png" onclick="toggleFullScreen(document.body)" class="img-fluid" alt="">
                    </a>
                </li>

                <li class="nav-item dropdown"> 
                    <a id="notifications" class="nav-link" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-bell-o"></i><span class="noti-numb-bg"></span><span class="badge">12</span>
                    </a>
                    <ul aria-labelledby="notifications" class="dropdown-menu">
                        <li>
                            <a rel="nofollow" href="#" class="dropdown-item nav-link">
                                <div class="notification">
                                    <div class="notification-content"><i class="fa fa-envelope bg-red"></i>Bạn có 6 tin nhắn mới</div>
                                    <div class="notification-time"><small>4 phút trước</small></div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a rel="nofollow" href="#" class="dropdown-item nav-link">
                                <div class="notification">
                                    <div class="notification-content"><i class="fa fa-upload bg-blue"></i>Máy chủ đã khởi động lại</div>
                                    <div class="notification-time"><small>10 phút trước</small></div>
                                </div>
                            </a>
                        </li>
                        <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center"> <strong>xem tất cả thông báo</strong></a></li>
                    </ul>
                </li>

                <li class="nav-item dropdown"> 
                    <a id="messages" class="nav-link logout" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-envelope-o"></i><span class="noti-numb-bg"></span><span class="badge">10</span>
                    </a>
                    <ul aria-labelledby="messages" class="dropdown-menu">
                        <li>
                            <a rel="nofollow" href="#" class="dropdown-item d-flex">
                                <div class="msg-profile"> <img src="img/avatar.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                <div class="msg-body">
                                    <h3 class="h5 msg-nav-h3">Hoàng Nam</h3><span>Đã gửi tin nhắn cho bạn</span>
                                </div>
                            </a>
                        </li>
                        <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center"> <strong>Đọc tất cả tin nhắn</strong></a></li>
                    </ul>
                </li> 

                <li class="nav-item dropdown">
                    <a id="profile" class="nav-link logout" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img src="img/avatar.jpg" alt="..." class="img-fluid rounded-circle" style="height: 30px; width: 30px;">
                    </a>
                    <ul aria-labelledby="profile" class="dropdown-menu profile">
                        <li>
                            <a rel="nofollow" href="#" class="dropdown-item d-flex">
                                <div class="msg-profile"> <img src="img/avatar.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                <div class="msg-body">
                                    <h3 class="h5">Quản lý</h3><span>quanly@gmail.com</span>
                                </div>
                            </a>
                        </li>
                        <hr>
                        <li><a rel="nofollow" href="profile.html" class="dropdown-item"><i class="fa fa-user"></i> Hồ sơ của tôi</a></li>
                        <li><a rel="nofollow" href="profile.html" class="dropdown-item"><i class="fa fa-cog"></i> Cài đặt</a></li>
                        <hr>
                        <li><a rel="nofollow" href="profile.html" class="dropdown-item"><i class="fa fa-power-off"></i> Đăng xuất</a></li>
                    </ul>
                </li>   
            </ul> 
        </div>
    </nav>
</header>

<!--PAGE CONTENT-->
    <div class="page-content d-flex align-items-stretch">

        <!--***** SIDE NAVBAR *****-->
        <nav class="side-navbar">
            <div class="sidebar-header d-flex align-items-center">
                <div class="avatar"><img src="img/avatar.jpg" alt="..." class="img-fluid rounded-circle"></div>
                <div class="title">
                    <h1 class="h4">Quản lý</h1>
                </div>
            </div>
            <hr>
            <!-- Sidebar Navidation Menus-->
            <ul class="list-unstyled">
                <li class="active"> <a href="index.html">Trang chủ</a></li>
                <li class="active"> <a href="email.html">Email</a></li>
                <li class="active"> <a href="tables.html">Bảng</a></li>
                <li class="active"> <a href="invoice.html">Hóa đơn</a></li>
        </nav>
        <div class="content-inner">

<!--REPORT-1-->
<div class="row" id="report1">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header-idt">
                <h4 class="title-idt"><i class="fa fa-list"></i> HỆ THỐNG QUẢN LÝ BẢO HÀNH</h4>
            </div>
            <div class="card-body no-padding">
                <div class="table-responsive">
                    <table class="table idt-table-report table-hover">
                        <thead>
                            <tr>
                                <th>Mã Thiết Bị</th>
                                <th>Tên Thiết Bị</th>
                                <th>Khách Hàng</th>
                                <th class="text-center">Ngày Hết Hạn</th>
                                <th class="text-center">Tình Trạng</th>
                                <th class="text-center">Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="admin-warranty-list">
                            <tr><td colspan="6" class="text-center">Đang tải dữ liệu bảo hành...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--REPORT-3-->
<div class="row" id="report3">
    <div class="col-md-12">
        <div class="card card-idt-main">
            <div class="card-header-idt">
                <h4 class="title-idt"><i class="fa fa-history"></i> Theo dõi tiến độ sửa chữa</h4>
            </div>
            <div class="card-body no-padding">
                <div class="table-responsive">
                    <table class="table idt-table-report table-hover">
                        <thead>
                            <tr>
                                <th>Mã Case</th>
                                <th>Thiết bị</th>
                                <th>Kỹ thuật viên</th>
                                <th>Tiến độ</th>
                                <th class="text-center">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody id="admin-repair-list">
                            <tr><td colspan="5" class="text-center">Đang tải dữ liệu sửa chữa...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--API-->
<script>
document.addEventListener("DOMContentLoaded", function() {
    
    // --- CẤU HÌNH ĐƯỜNG DẪN API (Bên Backend sẽ cung cấp các link này) ---
    const API_WARRANTY = "api/get_warranty.php"; // Placeholder cho Report 1
    const API_REPAIRS  = "api/get_repairs.php";  // Placeholder cho Report 3

    // 1. KẾT NỐI REPORT 1 (BẢO HÀNH)
    fetch(API_WARRANTY)
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('admin-warranty-list');
            tbody.innerHTML = ''; // Xóa dòng "Đang tải"

            data.forEach(item => {
                // Logic xử lý màu sắc trạng thái dựa trên dữ liệu database
                let statusClass = item.status === 'active' ? 'text-status-good' : 'text-status-expired';
                let statusText  = item.status === 'active' ? 'Đang bảo hành' : 'Đã hết hạn';

                tbody.innerHTML += `
                    <tr>
                        <td><strong>${item.id}</strong></td>
                        <td>${item.device_name}</td>
                        <td>${item.customer_name}</td>
                        <td class="text-center">${item.warranty_end_date}</td>
                        <td class="text-center"><span class="${statusClass}">${statusText}</span></td>
                        <td class="action-col text-center">
                            <button class="btn-idt-fixed btn-red" onclick="extendWarranty('${item.id}')">Gia hạn</button>
                        </td>
                    </tr>
                `;
            });
        })
        .catch(err => console.error("Lỗi kết nối API Report 1:", err));


    // 2. KẾT NỐI REPORT 3 (SỬA CHỮA)
    fetch(API_REPAIRS)
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('admin-repair-list');
            tbody.innerHTML = ''; // Xóa dòng "Đang tải"

            data.forEach(item => {
                // Logic hiển thị màu Progress Bar
                let barColor = 'bg-info';
                if(item.progress >= 90) barColor = 'bg-success';
                if(item.progress < 30) barColor = 'bg-danger';

                tbody.innerHTML += `
                    <tr>
                        <td><strong>${item.id}</strong></td>
                        <td>${item.device_name}</td>
                        <td>${item.technician_name}</td>
                        <td class="align-middle">
                            <div class="progress idt-progress-bar">
                                <div class="progress-bar ${barColor}" style="width: ${item.progress}%;"></div>
                            </div>
                            <small>${item.progress}%</small>
                        </td>
                        <td class="action-col text-center">
                            <span class="status-btn btn-info-idt">${item.status}</span>
                        </td>
                    </tr>
                `;
            });
        })
        .catch(err => console.error("Lỗi kết nối API Report 3:", err));
});

// Hàm mẫu cho nút hành động
function extendWarranty(id) {
    alert("Gửi yêu cầu gia hạn cho thiết bị: " + id);
}
</script>

<script>
// JS Load dữ liệu cho Quản lý
document.addEventListener("DOMContentLoaded", function() {
    // 1. Load Bảo hành (bảng devices + customers)
    fetch('api/get_all_devices.php')
    .then(response => response.json())
    .then(data => {
        const tbody = document.getElementById('admin-warranty-list');
        tbody.innerHTML = '';
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="text-center">Không có dữ liệu</td></tr>';
            return;
        }
        data.forEach(item => {
            let statusClass = item.status === 'active' ? 'text-status-good' : 'text-status-expired';
            let statusText = item.status === 'active' ? 'Đang bảo hành' : 'Đã hết hạn';
            tbody.innerHTML += `
                <tr>
                    <td><strong>${item.id}</strong></td>
                    <td>${item.device_name}</td>
                    <td>${item.customer_name}</td>
                    <td class="text-center">${item.warranty_end_date}</td>
                    <td class="text-center"><span class="${statusClass}">${statusText}</span></td>
                    <td class="action-col"><button class="btn-idt-fixed btn-red">Gia hạn</button></td>
                </tr>
            `;
        });
    })
    .catch(error => console.error('Error fetching warranty data:', error));

    // 2. Load Tiến độ (bảng repair_tickets + users)
    fetch('api/get_all_tickets.php')
    .then(response => response.json())
    .then(data => {
        const tbody = document.getElementById('admin-repair-list');
        tbody.innerHTML = '';
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center">Không có dữ liệu</td></tr>';
            return;
        }
        data.forEach(item => {
            tbody.innerHTML += `
                <tr>
                    <td><strong>${item.id}</strong></td>
                    <td>${item.device_name}</td>
                    <td>${item.technician_name}</td>
                    <td class="align-middle">
                        <div class="progress idt-progress-bar">
                            <div class="progress-bar bg-info" style="width: ${item.progress}%;"></div>
                        </div>
                    </td>
                    <td class="action-col text-center"><span class="status-btn btn-info-idt">${item.status}</span></td>
                </tr>
            `;
        });
    })
    .catch(error => console.error('Error fetching repair data:', error));
});
</script>

    <!--Global Javascript -->
    <script src="js/jquery.min.js"></script>
    <script src="js/popper/popper.min.js"></script>
    <script src="js/tether.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.validate.min.js"></script> 
    <script src="js/chart.min.js"></script> 
    <script src="js/front.js"></script> 
    
    <!--Core Javascript -->
    <script src="js/mychart.js"></script>
</body>

</html>
